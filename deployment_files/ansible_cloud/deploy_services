#Ansible server: 192.168.1.131
#Need to pre-config the switches
---
- name: Installing apache and FTP on Office 1 and Office 3 VM's
  hosts: OfficeVm1, OfficeVm3
  gather_facts: yes
  connection: local
  tasks:
  - name: Install apache2
    apt: name=apach2 update_cache=yes state=latest

  - name: Install FTP
    apt: name=vsftpd update_cache=yes state=latest

  - name: Adding Firewall rules
    command: "{{ item }}"
    with_items:
      - /bin/ufw allow OpenSSH
      - /bin/ufw allow 21/tcp
      - /bin/ufw allow 40000:50000/tcp
      - /bin/ufw allow 990/tcp
      - /bin/ufw enable

  - name: Adding a FTP user
    command: "{{ item }}"
    with_items:
      - adduser ftpuser
      - usermod -d /var/www ftpuser
      - chown ftpuser:ftpuser /var/www/html
      - systemctl restart vsftpd